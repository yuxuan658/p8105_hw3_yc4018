---
title: "p8105_hw3_yc4018"
author: "Yuxuan Chen"
output: github_document
---
```{r message = FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```
 - Above code is for setting options of graphs

**Problem 1**
```{r collapse = TRUE}
data("instacart")
```

1. How many aisles are there, and which aisles are the most items ordered from?
```{r}
aisle_obs = 
  instacart %>%
  group_by(aisle) %>% 
  summarize(n_obs = n()) %>% 
  arrange(desc(n_obs))

knitr::kable(aisle_obs[0:10,])
```
 - There are `r nrow(aisle_obs)`in the dataset. Since `r aisle_obs[1,2]` is the largest observations of aisle, fresh vegetables is the aisle that the most items ordered from.

2. Below is a scatter plot that shows the number of items ordered in each aisle, which with more than 10000 items ordered. 
```{r}
aisle_obs %>% 
  filter(n_obs > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n_obs)) %>% 
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(
    title = "The Number of Items Ordered In Each Aisle",
    x = "Aisle",
    y = "Number of items"
  )
```

3. Below table shows the 3 most popular products in each of the aisles of “baking ingredients”, “dog food care”, and “packaged vegetables fruits”, with the number of times each item is ordered.
```{r message = FALSE}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care","packaged vegetables fruits")) %>%
  group_by(aisle, product_name) %>% 
  summarize(n_times = n()) %>% 
  mutate(
    product_rank = min_rank(desc(n_times)) #rank the items from most popular to least popular
  ) %>% 
  filter(product_rank <= 3) %>% 
  arrange(aisle, product_rank) %>% 
  knitr::kable()
```

4. Below table shows the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.
```{r}
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hour = mean(order_hour_of_day, na.rm = TRUE)) %>% 
  pivot_wider(
    names_from = "order_dow",
    values_from = "mean_hour"
  ) %>% 
  knitr::kable()
```

5. **Dataset Interpretation: **
write a short description of the dataset, noting the size and structure of the data, describing some key variables, and giving illstrative examples of observations. 

 - The instacart dataset contains 1384617 observations of 15 variables and each row in the dataset is a product from an order, which helps to examine the trends in online grocery purchasing. The size of this dataset is (`r dim(instacart)`). I think the key variables are `aisle`; `department`; `product_name`; `add_to_cart_order`, which represents the order in which each product was added to cart; `reordered`, which shows if this product has been ordered by this user in the past; `order_dow`, which shows the day of the week on which the order was placed; `order_hour_of_day`,which represents the hour of the day on which the order was placed; and `days_since_prior_order`, which indicates the days since the last order.

***
**Problem 2**
```{r warning = FALSE}
data("brfss_smart2010")

brfss_df = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% #use appropriate variable names
  filter(topic == "Overall Health") %>%  # focus on Overall Health topic
  separate(locationdesc, into = c("state", "location"), "-", convert = TRUE) %>%
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>%
  mutate(response = factor(response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent"))) %>% view
```

1. In 2002, which states were observed at 7 or more locations? What about in 2010?
```{r message = FALSE}
#In 2002:

brfss_2002 = 
  brfss_df %>% 
  filter(year == 2002) %>%
  select(state, location) %>%
  group_by(state) %>% 
  distinct(location, .keep_all = TRUE) %>%
  summarize(n_location = n()) %>% 
  filter(n_location >= 7) 

knitr::kable(brfss_2002)

#in 2010
brfss_2010 = 
  brfss_df %>% 
  filter(year == 2010) %>%
  select(state, location) %>%
  group_by(state) %>% 
  distinct(location, .keep_all = TRUE) %>%
  summarize(n_location = n()) %>% 
  filter(n_location >= 7) 

knitr::kable(brfss_2010)
```
 - Hence, in 2002, `CT, FL, MA, NC, NJ, PA are the states that were observed at 7 or more locations. And in 2010, CA, CO, FL, MA, MD, NC, NE, NJ, NY, OH, PA, SC, TX, WA are the states that were observed at 7 or more locations.
